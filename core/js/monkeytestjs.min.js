/*! monkeytestjs - v1.0.0 - 2013-07-31 */ 
!function(a){var b=a._MonkeyTestJS=a._MonkeyTestJS||{},c=b.MonkeyTestJS=function(){};c.prototype.setupTests=function(){var a=this.config.globalTests||[];this.pages=[],this.pagesToTest=[],this.tests={},this.testsToLoad=[];for(var c=0,d=this.config.pages.length;d>c;c++){var e=new b.MonkeyTestJSPage(this.config.pages[c]),f=this.config.pages[c].tests||[];e.runner=this,this.pagesToTest.push(this.config.pages[c].url);for(var g=0,h=a.length;h>g;g++)e.tests.push(this.getTest(a[g]));for(var i=0,j=f.length;j>i;i++)e.tests.push(this.getTest(f[i]));e.totalTestsToBeRunned=e.tests.length,this.pages.push(e)}},c.prototype.addTest=function(a){var c=this.tests[a]=new b.MonkeyTestJSTest({src:a},this);return this.testsToLoad.push(c),c},c.prototype.getTest=function(a){var b=this.tests[a]||this.addTest(a);return b},c.prototype.loadNextTest=function(){var a=this,b=this.loadingCurrentTest=this.testsToLoad.shift(),c={loadTest:function(){b.load()},finishTesting:function(){a.loadTestsDone()}};c[b?"loadTest":"finishTesting"]()},c.prototype.registerTest=function(a,b){this.loadingCurrentTest.test=b,this.loadingCurrentTest.name=a,this.loadNextTest()},c.prototype.loadTestsDone=function(){QUnit.start(),this.startTests()},c.prototype.startTests=function(){this.currentPage=this.pages.shift(),this.nextPageTest()},c.prototype.nextPageTest=function(){this.currentPage&&!this.currentPage.runNextTest()&&(this.currentPage=this.pages.shift(),this.nextPageTest())},c.prototype.start=function(a){return this.config={testsDir:"/tests/",pageTests:{},globalTests:[]},b.Utils.__extends(this.config,a||{}),this.testsUrl=/^[^\/]+:\/\/[^\/]+\//.exec(location.href)[0]+this.config.testsDir,this.workspace=this.config.workspace,this.jQuery=this.config.jQuery,this.setupTests(),this.loadNextTest(),this}}(this),function(a){var b=a._MonkeyTestJS=a._MonkeyTestJS||{},c=b.MonkeyTestJSPage=function(a,c){a=a||{},b.Utils.__extends(this,a),this.source="",this.tests=[],this.currentTest=-1,this.runner=c};c.prototype.loadSource=function(a){if(""!==this.source)return a(),void 0;var b=this;this.runner.jQuery.get(this.url).success(function(c){b.source=c,a()}).error(function(){a()})},c.prototype.runNextTest=function(a){var c=this.totalTestsToBeRunned===this.tests.length,d=this.tests.shift(),e=a||function(){},f=!1;if(d){var g=new b.MonkeyTestJSPageTest({},this.runner);g.testSpec=d,g.runner=this.runner,g.page=this,g.window=g.workspace=this.runner.workspace,g.$=this.runner.workspace.jQuery,g.runTest(c),f=!0}return e(f),f}}(this),function(a){var b=a._MonkeyTestJS=a._MonkeyTestJS||{},c=b.MonkeyTestJSPageTest=function(a){a=a||{},b.Utils.__extends(this,a),this.chain=[]};c.prototype.runTest=function(a){var b=this,c=function(a){a&&"function"==typeof a&&a.call(b,b.workspace.jQuery)},d=b.testSpec.test,e={isFunction:function(){c(d)},isObject:function(){c(d.setup),c(d.load)}};a&&this.loadPage().loadPageSource(),e["function"==typeof d?"isFunction":"isObject"](),QUnit.module("Testing "+b.page.url),b.start()},c.prototype.start=function(){return this._next(),this},c.prototype._next=function(){var a=this,b=this.chain.shift(),c={callCurrentPageAction:function(){b.call(a)},callNextPage:function(){a.runner.nextPageTest()}};c[b?"callCurrentPageAction":"callNextPage"]()},c.prototype.env=function(){var a,b,c=this,d=c.runner.config.envs;return b=a="default",this.runner.jQuery.each(d,function(e){var f=d[e];return c.runner.jQuery.each(f,function(a,d){return c.runner.workspace.location.href.indexOf(d)>=0?(b=e,!1):void 0}),b!==a?!1:void 0}),b},c.prototype.config=function(){return this.runner.config},c.prototype.loadPageSource=function(){var a=this,b=function(){a.page.loadSource(function(){a._next()})};return this.chain.push(b),this},c.prototype.loadPage=function(a){a=a||this.page.url;var b=this,c=function(){b._next(),b.runner.jQuery("#workspace").off("load",c)},d=function(){b.runner.jQuery("#workspace").on("load",c),b.runner.jQuery("#workspace").attr("src",a)};return this.chain.push(d),this},c.prototype.waitForPageLoad=function(b){var c=this,d=b||5e3,e=function(){c._next(),c.runner.jQuery("#workspace").off("load",e)},f=function(){c._waitingTimer=a.setTimeout(e,d),c.runner.jQuery("#workspace").on("load",function(){a.clearTimeout(c._waitingTimer),e()})};return c.chain.push(f),c},c.prototype.run=function(a){var b=this,c=function(){a.call(b,b.workspace.jQuery),b._next()};return this.chain.push(c),this},c.prototype.asyncRun=function(a){var b=this,c=function(){a.call(b,b.workspace.jQuery)};return this.chain.push(c),this},c.prototype.asyncRunDone=function(){this._next()},c.prototype.test=function(a,b){var c=this,d=function(){test(a,function(){b.call(c,c.workspace.jQuery)}),c._next()};return this.chain.push(d),this},c.prototype.wait=function(a){var b=this;a=a||1e3;var c=function(){setTimeout(function(){b._next()},a)};return this.chain.push(c),this},c.prototype.asyncTest=function(a,b){var c=this,d=function(){asyncTest(a,function(){b.call(c,c.workspace.jQuery)})};return this.chain.push(d),this},c.prototype.asyncTestDone=function(){var a=this;QUnit.start(),a._next()}}(this),function(a){var b=a._MonkeyTestJS=a._MonkeyTestJS||{},c=b.MonkeyTestJSTest=function(a,c){a=a||{},b.Utils.__extends(this,a),this.runner=c};c.prototype.load=function(){var b=this;return new Date,a.$$.ajax({url:b.runner.testsUrl+b.src,success:function(){},error:function(){},dataType:"script",async:!1}),!0}}(this),function(a){var b=a._MonkeyTestJS=a._MonkeyTestJS||{},c=b.Utils={log:function(b){a.console&&console.log(b)},registerTest:function(b,c){a.monkeytestjs.registerTest(b,c)},__extends:function(a,b){function c(){this.constructor=a}for(var d in b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return b.prototype&&(c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype),a}},d=c.log,e=c.registerTest;c.__extends,a.log=d,a.registerTest=e}(this),function(a){a.QUnit.config.autostart=!1;var b=a._MonkeyTestJS=a._MonkeyTestJS||{},c=a.$$=a.jQuery.noConflict(!0),d=a.monkeytestjs=new b.MonkeyTestJS,e=function(){c.getJSON("config.json",function(a){d.start(c.extend({},{workspace:window.frames[0],jQuery:c},a))}).fail(function(){a.alert("Failed to load config.json, please make sure this file exist and it is correctly formatted.")})};c(e)}(this);