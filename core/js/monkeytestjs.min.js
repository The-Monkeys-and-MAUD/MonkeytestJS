/*! monkeytestjs - v1.0.1 - 2014-02-18 */ 
!function(a){var b=a._MonkeyTestJS=a._MonkeyTestJS||{},c=b.MonkeyTestJS=function(){this._onCompleteCallback=[]};c.prototype.setupTests=function(){var a=this.config.globalTests||[];this.pages=[],this.tests={},this.testsToLoad=[];for(var c=0,d=this.config.pages.length;d>c;c++){var e=new b.MonkeyTestJSPage(this.config.pages[c]),f=this.config.pages[c].tests||[];e.runner=this,e.uri=e.url,"/"!==e.url.charAt(0)&&(e.url=this.baseUrl+e.url);for(var g=0,h=a.length;h>g;g++)e.tests.push(this.getTest(a[g]));for(var i=0,j=f.length;j>i;i++)e.tests.push(this.getTest(f[i]));e.totalTestsToBeRunned=e.tests.length,this.pages.push(e)}},c.prototype.addTest=function(a){var c=this.tests[a]=new b.MonkeyTestJSTest({src:a},this);return this.testsToLoad.push(c),c},c.prototype.getTest=function(a){var b=this.tests[a]||this.addTest(a);return b},c.prototype.loadNextTest=function(){var a=this,b=this.loadingCurrentTest=this.testsToLoad.shift(),c={loadTest:function(){b.load()},finishTesting:function(){a.loadTestsDone()}};c[b?"loadTest":"finishTesting"]()},c.prototype.registerTest=function(a,b){this.loadingCurrentTest.test=b,this.loadingCurrentTest.name=a,this.loadNextTest()},c.prototype.loadTestsDone=function(){QUnit.start(),this.startTests()},c.prototype.startTests=function(){this.currentPage=this.pages.shift(),this.nextPageTest()},c.prototype.nextPageTest=function(){var a=this;this.currentPage?this.currentPage.runNextTest(function(b){b||(a.currentPage=a.pages.shift(),a.nextPageTest())}):this.__FINSHEDRUNNING||(this.__FINSHEDRUNNING=!0,this.__FINISH())},c.prototype.start=function(c){return this.config={testsDir:"mytests/",loadSources:!0,pageTests:{},globalTests:[]},a.$$.each(c,function(b,d){if(d.hasOwnProperty&&d.hasOwnProperty("env")){var e=d,f=e.env;a.$$.each(f,function(d,f){f instanceof RegExp||(f=new RegExp(f)),f.test(location.href)&&(c.environment=b,a.$$.each(e,function(a,b){c[a]=b}))}),delete c[b]}}),b.Utils.__extends(this.config,c||{}),"file"===location.href.substr(0,4)&&("undefined"!=typeof console&&"undefined"!=typeof console.log&&console.log("Running from local filesystem so disabling loading page sources"),this.config.loadSources=!1),"function"==typeof this.config.onFinish&&this.onFinish(this.config.onFinish),this.baseUrl=location.href.substr(0,location.href.lastIndexOf("/")+1),this.testsUrl=""===this.config.testsDir?this.baseUrl:"/"===this.config.testsDir.charAt(0)?this.config.testsDir:this.baseUrl+this.config.testsDir,""!==this.testsUrl&&"/"!==this.testsUrl.charAt(this.testsUrl.length-1)&&(this.testsUrl+="/"),this.workspace=this.config.workspace,this.jQuery=this.config.jQuery,this.setupProxy(),this.setupTests(),this.loadNextTest(),this},c.prototype.setupProxy=function(){var c,d=this.config.proxyUrl,e=a.$$,f=this;if(d.indexOf("<%")>=0){var g=b.template(d);c=function(a){return g({url:a})}}else c=function(a){return d+a};this.ajax=function(a,b){return"object"==typeof a&&(b=a,a=b.url),e.ajax(e.extend({},b,{url:c(a)}))},e.each(["get","post"],function(a,b){f[b]=function(a,c,d,g){return e.isFunction(c)&&(g=g||d,d=c,c=void 0),f.ajax({url:a,type:b,dataType:g,data:c,success:d})}})},c.prototype.onFinish=function(a){return"function"==typeof a&&this._onCompleteCallback.push(a),this},c.prototype.__FINISH=function(){var a,b,c=this._onCompleteCallback;for(a=0,b=c.length;b>a;a++)c[a].call(this);return!0}}(this),function(a){var b=a._MonkeyTestJS=a._MonkeyTestJS||{},c=b.MonkeyTestJSPage=function(a,c){a=a||{},b.Utils.__extends(this,a),this.source="",this.tests=[],this.currentTest=-1,this.runner=c};c.prototype.loadSource=function(a,b){var c=this,d=a||this.url;this.runner.jQuery.get(d).success(function(a,d,e){c.status=e.status,c.source=a,b()}).error(function(a){c.status=a.status,c.source=a.responseText,b()})},c.prototype.runNextTest=function(a){var c=this.totalTestsToBeRunned===this.tests.length,d=(1===this.tests.length,a||function(){}),e=this.tests.shift();if(e){var f=this,g=function(){var a=new b.MonkeyTestJSPageTest(f.runner);a.testSpec=e,a.runner=f.runner,a.page=f,a.window=a.workspace=f.runner.workspace,a.runTest(c),d(!0)};c?("function"==typeof this.runner.config.onLoadPage&&this.runner.config.onLoadPage.call(this,this.url),"function"==typeof this.runner.config.onLoadPageAsync?this.runner.config.onLoadPageAsync.call(this,this.url,g):g()):g()}else{var h=function(){d(!1)};"function"==typeof this.runner.config.onPageTestsComplete&&this.runner.config.onPageTestsComplete.call(this),"function"==typeof this.runner.config.onPageTestsCompleteAsync?this.runner.config.onPageTestsCompleteAsync.call(this,this.url,h):h()}return!!e}}(this),function(a){var b=a._MonkeyTestJS=a._MonkeyTestJS||{},c=b.MonkeyTestJSPageTest=function(b){this.runner=b,this.config=b.config;var c=this;a.$$.each(["ajax","get","post"],function(a,d){c[d]=function(){return b[d].apply(b,arguments)}}),this.chain=[]};c.prototype.runTest=function(a,b){var c=this,d=b||function(){},e=function(a){a&&"function"==typeof a&&a.call(c,c.getJQuery())},f=c.testSpec.test,g={isFunction:function(){e(f)},isObject:function(){e(f.setup),e(f.load)}};a&&this.loadPage(),g["function"==typeof f?"isFunction":"isObject"](),QUnit.module("Testing "+c.page.uri+" - "+c.testSpec.name),c.start(),d()},c.prototype.start=function(){return this._next(),this},c.prototype._next=function(){var a=this,b=this.chain.shift(),c={callCurrentPageAction:function(){b.call(a)},callNextPage:function(){a.runner.nextPageTest()}};c[b?"callCurrentPageAction":"callNextPage"]()},c.prototype.loadPage=function(a){var b=this,c=a||this.page.url;return this.waitForPageLoadAfter(function(){b.runner.jQuery("#workspace").attr("src",c)})},c.prototype.waitForPageLoadAfter=function(a,b){var c=this,d=b||5e3,e=c.window,f=function(){if(!c.loadSources){var a=e.document.doctype||{name:"html"};a="<!DOCTYPE "+a.name+(a.publicId?' PUBLIC "'+a.publicId+'"':"")+(!a.publicId&&a.systemId?" SYSTEM":"")+(a.systemId?' "'+a.systemId+'"':"")+">\n",c.page.source=a+e.document.documentElement.outerHTML}if(e.jQuery)h();else{var b=c.runner.jQuery("script[src*=jquery]").attr("src");"/"!==b.charAt(0)&&0!==b.indexOf("//")&&b.indexOf("://")<0&&(b=c.runner.baseUrl+b);var d,f=e.document.getElementsByTagName("script")[0];if(d=e.document.createElement("script"),d.src=b,f)f.parentNode.insertBefore(d,f);else{var g=e.document.getElementsByTagName("body")[0];g.insertBefore(d,g.lastChild)}setTimeout(function(){h()},10)}},g=function(){clearTimeout(c._waitingTimer),c._next(),c.runner.jQuery("#workspace").off("load",f)},h=g;return this.config.loadSources&&(h=function(){c._waitingTimer=setTimeout(g,d),c.page.loadSource(c.runner.jQuery("#workspace").attr("src"),function(){g()})}),this.chain.push(function(){c.runner.jQuery("#workspace").on("load",f),a.call(c,c.getJQuery())}),this},c.prototype.test=function(a,b){var c=this,d=function(){test(a,function(){b.call(c,c.getJQuery())}),c._next()};return this.chain.push(d),this},c.prototype.getJQuery=function(){return this.runner.workspace.jQuery||this.runner.jQuery},c.prototype.wait=function(a,b,c){var d=this,e=a||function(){},f=b||5e3,g=c||60,h=function(){var a=this,b=new Date;setTimeout(function c(){e()||new Date-b>=f?(clearTimeout(a._throttle),d._next()):a._throttle=setTimeout(c,g)},g)};return this.chain.push(h),this},c.prototype.asyncTest=function(a,b){var c=this,d=function(){asyncTest(a,function(){b.call(c,c.getJQuery())})};return this.chain.push(d),this},c.prototype.asyncTestDone=function(){var a=this;QUnit.start(),a._next()}}(this),function(a){var b=a._MonkeyTestJS=a._MonkeyTestJS||{},c=b.MonkeyTestJSTest=function(a,c){a=a||{},b.Utils.__extends(this,a),this.runner=c,this.config=c.config};c.prototype.load=function(){var a,b=document.getElementsByTagName("script")[0],c="/"===this.src.charAt(0)?this.src:this.runner.testsUrl+this.src;return a=document.createElement("script"),a.src=c+(c.indexOf("?")>=0?"&":"?")+"_="+1e16*Math.random(),b.parentNode.insertBefore(a,b),!0}}(this),function(a){var b=a._MonkeyTestJS=a._MonkeyTestJS||{},c=b.Utils={log:function(b){a.console&&console.log(b)},registerTest:function(b,c){a.monkeytestjs.registerTest(b,c)},__extends:function(a,b){function c(){this.constructor=a}for(var d in b)Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return b.prototype&&(c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype),a}},d=c.log,e=c.registerTest;c.__extends,a.log=d,a.registerTest=e}(this),function(a){var b={},c={},d=Array.prototype,e=Object.keys,f=d.forEach,g=d.slice;c.keys=e||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[];for(var d in a)c.has(a,d)&&b.push(d);return b};var h=function(a,d,e){if(null!=a)if(f&&a.forEach===f)a.forEach(d,e);else if(a.length===+a.length){for(var g=0,h=a.length;h>g;g++)if(d.call(e,a[g],g,a)===b)return}else for(var i=c.keys(a),g=0,h=i.length;h>g;g++)if(d.call(e,a[i[g]],i[g],a)===b)return};c.defaults=function(a){return h(g.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a},c.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var i=/(.)^/,j={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},k=/\\|'|\r|\n|\t|\u2028|\u2029/g;c.template=function(a,b,d){var e;d=c.defaults({},d,c.templateSettings);var f=new RegExp([(d.escape||i).source,(d.interpolate||i).source,(d.evaluate||i).source].join("|")+"|$","g"),g=0,h="__p+='";a.replace(f,function(b,c,d,e,f){return h+=a.slice(g,f).replace(k,function(a){return"\\"+j[a]}),c&&(h+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(h+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(h+="';\n"+e+"\n__p+='"),g=f+b.length,b}),h+="';\n",d.variable||(h="with(obj||{}){\n"+h+"}\n"),h="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+h+"return __p;\n";try{e=new Function(d.variable||"obj","_",h)}catch(l){throw l.source=h,l}if(b)return e(b,c);var m=function(a){return e.call(this,a,c)};return m.source="function("+(d.variable||"obj")+"){\n"+h+"}",m};var l=a._MonkeyTestJS=a._MonkeyTestJS||{};l.template=c.template}(this),function(a){"use strict";a.QUnit.config.autostart=!1;var b=a._MonkeyTestJS=a._MonkeyTestJS||{},c=a.$$=a.jQuery.noConflict(!0);c(function(){function d(d){var e=a.monkeytestjs=new b.MonkeyTestJS;e.start(c.extend({},{workspace:window.frames[0],jQuery:c},d))}if("object"==typeof a.monkeytestjs){var e=a.monkeytestjs;d(e)}else c.getJSON("config.json",function(a){d(a)}).fail(function(){a.alert("Failed to load config.json. Please make sure this file exists and it is correctly formatted.\n\nAlternatively, configure MonkeyTestJS by defining a global variable before including the monkeytestjs script:\n\n    var monkeytestjs = <contents of config.json>;")})})}(this);