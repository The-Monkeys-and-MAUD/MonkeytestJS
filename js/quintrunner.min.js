/*! quintrunner - v0.1.0 - 2013-05-09 */ 
(function(t){var e=function(e){t.console&&console.log(e)},s=function(e,s){t.QUnitRunner.registerTest(e,s)},n=Object.prototype.hasOwnProperty,r=function(t,e){function s(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return e.prototype&&(s.prototype=e.prototype,t.prototype=new s,t.__super__=e.prototype),t},i=function(){};i.prototype.start=function(t,e){t=t||{},this.config={testsDir:"/tests/",pageTests:{},globalTests:[]},r(this.config,t),this.testsUrl=/^[^\/]+:\/\/[^\/]+\//.exec(location.href)[0]+this.config.testsDir,this.workspace=this.config.workspace,this.jQuery=this.config.jQuery;var s=0,n=0;if(e=e||[],0===e.length)for(s=0;this.config.pages.length>s;s++)e.push(this.config.pages[s].url);for(this.pagesToTest=e,this.tests={},this.testsToLoad=[],s=0,this.pages=[],s=0;this.config.pages.length>s;s++){var i=new o(this.config.pages[s]);for(i.runner=this,n=0;this.config.globalTests.length>n;n++)i.tests.push(this.getTest(this.config.globalTests[n]));if(this.config.pages[s].tests)for(n=0;this.config.pages[s].tests.length>n;n++)i.tests.push(this.getTest(this.config.pages[s].tests[n]));this.pages.push(i)}return this.loadNextTest(),this},i.prototype.getTest=function(t){if(!this.tests.hasOwnProperty(t)){var e=new h({src:t},this);this.tests[t]=e,this.testsToLoad.push(e)}return this.tests[t]},i.prototype.loadNextTest=function(){this.loadingCurrentTest=this.testsToLoad.shift(),this.loadingCurrentTest?this.loadingCurrentTest.load():this.loadTestsDone()},i.prototype.registerTest=function(t,s){e("->registerTest "+this.loadingCurrentTest.src+" "+t),this.loadingCurrentTest,this.loadingCurrentTest.test=s,this.loadingCurrentTest.name=t,this.loadNextTest()},i.prototype.loadTestsDone=function(){this.startTests()},i.prototype.startTests=function(){e("->startTests "),e(this.tests),QUnit.start(),this.currentPage=this.pages.shift(),this.nextPageTest()},i.prototype.nextPageTest=function(){this.currentPage?this.currentPage.runNextTest()||(this.currentPage=this.pages.shift(),this.nextPageTest()):e("All test complete")};var o=function(t,e){t=t||{},r(this,t),this.source="",this.tests=[],this.currentTest=-1,this.runner=e};o.prototype.loadSource=function(t){if(""!==this.source)return t(),void 0;var e=this;this.runner.jQuery.get(this.url).success(function(s){e.source=s,t()}).error(function(){t()})},o.prototype.runNextTest=function(){var t=this.tests.shift();if(t){var e=new a({},this.runner);return e.testSpec=t,e.runner=this.runner,e.page=this,e.window=e.workspace=this.runner.workspace,e.$=this.runner.workspace.jQuery,e.runTest(),!0}return!1};var h=function(t,e){t=t||{},r(this,t),this.runner=e};h.prototype.load=function(){this.addTestScript("",this.src)},h.prototype.addTestScript=function(t,e){e=this.runner.testsUrl+e;var s,n=document,r=n.getElementsByTagName("script")[0];s=n.createElement("script"),s.async=!0,s.src=e,r.parentNode.insertBefore(s,r)};var a=function(t){t=t||{},r(this,t),this.chain=[]};a.prototype.runTest=function(){e("->testPageTest starting "+this.page.url+" with "+this.testSpec.name);var t=this;QUnit.module("testing "+this.page.url+" with "+this.testSpec.name),this.test.test instanceof Function?this.config.jQuery("#workspace").on("load",function(){t.testSpec.test.call(t,t.workspace.jQuery,0)}):(this.testSpec.test.setup&&this.testSpec.test.setup.call(this),this.testSpec.test.load&&t.testSpec.test.load.call(t,t.workspace.jQuery))},a.prototype.start=function(){return e("->testPageTest  "+this.page.url+":"+this.testSpec.name+" start "+this.chain.length),this._next(),this},a.prototype._next=function(){e("->testPageTest  "+this.page.url+":"+this.testSpec.name+" _next");var t=this.chain.shift();t?t.call(this):(e("->testPageTest complete "+this.page.url+" with "+this.testSpec.name),this.runner.nextPageTest())},a.prototype.env=function(){var t=this.runner.config.envs,e="notfound",s=this;return this.runner.jQuery.each(t,function(n){var r=t[n];return s.runner.jQuery.each(r,function(t,r){return s.runner.workspace.location.href.indexOf(r)>=0?(e=n,!1):void 0}),"notfound"!==e?!1:void 0}),e},a.prototype.config=function(){return this.runner.config},a.prototype.loadPageSource=function(){var t=this,e=function(){t.page.loadSource(function(){t._next()})};return this.chain.push(e),this},a.prototype.loadPage=function(t){t=t||this.page.url;var e=this,s=function(){e._next(),e.runner.jQuery("#workspace").off("load",s)},n=function(){e.runner.jQuery("#workspace").on("load",s),e.runner.jQuery("#workspace").attr("src",t)};return this.chain.push(n),this},a.prototype.waitForPageLoad=function(){var t=this,e=function(){t._next(),t.runner.jQuery("#workspace").off("load",e)},s=function(){t.runner.jQuery("#workspace").on("load",e)};return this.chain.push(s),this},a.prototype.run=function(t){var e=this,s=function(){t.call(e,e.workspace.jQuery),e._next()};return this.chain.push(s),this},a.prototype.asyncRun=function(t){var e=this,s=function(){t.call(e,e.workspace.jQuery)};return this.chain.push(s),this},a.prototype.asyncRunDone=function(){this._next()},a.prototype.test=function(t,e){var s=this,n=function(){test(t,function(){e.call(s,s.workspace.jQuery)}),QUnit.start(),s._next()};return this.chain.push(n),this},a.prototype.asyncTest=function(t,e){var s=this,n=function(){asyncTest(t,function(){e.call(s,s.workspace.jQuery)})};return this.chain.push(n),this},a.prototype.asyncTestDone=function(){var t=this;QUnit.start(),t._next()},t.QUnitRunnerPageTest=a,t.log=e,t.registerTest=s,t.QUnitRunner=new i})(this);